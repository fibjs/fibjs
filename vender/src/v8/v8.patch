--- /Users/lion/Downloads/source/js/v8/src/arm/deoptimizer-arm.cc	2014-06-09 04:42:32.000000000 +0800
+++ src/arm/deoptimizer-arm.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM
+
 #include "src/codegen.h"
 #include "src/deoptimizer.h"
 #include "src/full-codegen.h"
@@ -355,3 +357,5 @@
 #undef __
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm/lithium-arm.cc	2014-06-22 19:23:17.000000000 +0800
+++ src/arm/lithium-arm.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM
+
 #include "src/arm/lithium-arm.h"
 #include "src/arm/lithium-codegen-arm.h"
 #include "src/hydrogen-osr.h"
@@ -2596,3 +2598,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm/lithium-codegen-arm.cc	2014-06-22 19:23:17.000000000 +0800
+++ src/arm/lithium-codegen-arm.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM
+
 #include "src/arm/lithium-codegen-arm.h"
 #include "src/arm/lithium-gap-resolver-arm.h"
 #include "src/code-stubs.h"
@@ -5840,3 +5842,5 @@
 #undef __
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm/lithium-gap-resolver-arm.cc	2014-06-22 19:23:17.000000000 +0800
+++ src/arm/lithium-gap-resolver-arm.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM
+
 #include "src/arm/lithium-codegen-arm.h"
 #include "src/arm/lithium-gap-resolver-arm.h"
 
@@ -300,3 +302,5 @@
 #undef __
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm64/deoptimizer-arm64.cc	2014-06-13 20:40:35.000000000 +0800
+++ src/arm64/deoptimizer-arm64.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM64
+
 #include "src/codegen.h"
 #include "src/deoptimizer.h"
 #include "src/full-codegen.h"
@@ -383,3 +385,5 @@
 #undef __
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm64/instrument-arm64.cc	2014-06-09 04:42:32.000000000 +0800
+++ src/arm64/instrument-arm64.cc	2014-06-22 19:58:53.000000000 +0800
@@ -2,6 +2,10 @@
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
 
+#include "src/v8.h"
+
+#if V8_TARGET_ARCH_ARM64
+
 #include "src/arm64/instrument-arm64.h"
 
 namespace v8 {
@@ -593,3 +597,5 @@
 
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm64/lithium-arm64.cc	2014-06-22 19:23:17.000000000 +0800
+++ src/arm64/lithium-arm64.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM64
+
 #include "src/arm64/lithium-arm64.h"
 #include "src/arm64/lithium-codegen-arm64.h"
 #include "src/hydrogen-osr.h"
@@ -2723,3 +2725,5 @@
 
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm64/lithium-codegen-arm64.cc	2014-06-22 19:23:17.000000000 +0800
+++ src/arm64/lithium-codegen-arm64.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM64
+
 #include "src/arm64/lithium-codegen-arm64.h"
 #include "src/arm64/lithium-gap-resolver-arm64.h"
 #include "src/code-stubs.h"
@@ -6059,3 +6061,5 @@
 
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/arm64/lithium-gap-resolver-arm64.cc	2014-06-22 19:23:17.000000000 +0800
+++ src/arm64/lithium-gap-resolver-arm64.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,8 @@
 
 #include "src/v8.h"
 
+#if V8_TARGET_ARCH_ARM64
+
 #include "src/arm64/lithium-codegen-arm64.h"
 #include "src/arm64/lithium-gap-resolver-arm64.h"
 
@@ -309,3 +311,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-freebsd.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-freebsd.cc	2014-06-22 19:58:53.000000000 +0800
@@ -5,6 +5,10 @@
 // Platform-specific code for FreeBSD goes here. For the POSIX-compatible
 // parts, the implementation is in platform-posix.cc.
 
+#include <osconfig.h>
+
+#ifdef FreeBSD
+
 #include <pthread.h>
 #include <semaphore.h>
 #include <signal.h>
@@ -304,3 +308,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-linux.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-linux.cc	2014-06-22 19:58:53.000000000 +0800
@@ -5,6 +5,10 @@
 // Platform-specific code for Linux goes here. For the POSIX-compatible
 // parts, the implementation is in platform-posix.cc.
 
+#include <osconfig.h>
+
+#ifdef Linux
+
 #include <pthread.h>
 #include <semaphore.h>
 #include <signal.h>
@@ -429,3 +433,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-macos.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-macos.cc	2014-06-22 19:58:53.000000000 +0800
@@ -5,6 +5,10 @@
 // Platform-specific code for MacOS goes here. For the POSIX-compatible
 // parts, the implementation is in platform-posix.cc.
 
+#include <osconfig.h>
+
+#ifdef MacOS
+
 #include <dlfcn.h>
 #include <mach/mach_init.h>
 #include <mach-o/dyld.h>
@@ -307,3 +311,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-openbsd.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-openbsd.cc	2014-06-22 19:58:53.000000000 +0800
@@ -5,6 +5,10 @@
 // Platform-specific code for OpenBSD and NetBSD goes here. For the
 // POSIX-compatible parts, the implementation is in platform-posix.cc.
 
+#include <osconfig.h>
+
+#ifdef OpenBSD
+
 #include <pthread.h>
 #include <semaphore.h>
 #include <signal.h>
@@ -335,3 +339,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-posix.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-posix.cc	2014-06-22 19:58:53.000000000 +0800
@@ -6,6 +6,10 @@
 // own, but contains the parts which are the same across the POSIX platforms
 // Linux, MacOS, FreeBSD, OpenBSD, NetBSD and QNX.
 
+#include <osconfig.h>
+
+#ifndef Windows
+
 #include <dlfcn.h>
 #include <errno.h>
 #include <pthread.h>
@@ -241,12 +245,12 @@
   return static_cast<size_t>(sysconf(_SC_PAGESIZE));
 }
 
-
+#if 0
 void OS::Sleep(int milliseconds) {
   useconds_t ms = static_cast<useconds_t>(milliseconds);
   usleep(1000 * ms);
 }
-
+#endif
 
 void OS::Abort() {
   if (FLAG_hard_abort) {
@@ -461,7 +465,7 @@
   strncpy(dest, src, n);
 }
 
-
+#if 0
 // ----------------------------------------------------------------------------
 // POSIX thread support.
 //
@@ -695,6 +699,8 @@
   ASSERT_EQ(0, result);
   USE(result);
 }
-
+#endif
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-qnx.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-qnx.cc	2014-06-22 19:58:53.000000000 +0800
@@ -5,6 +5,10 @@
 // Platform-specific code for QNX goes here. For the POSIX-compatible
 // parts the implementation is in platform-posix.cc.
 
+#include <osconfig.h>
+ 
+#ifdef Qnx
+ 
 #include <backtrace.h>
 #include <pthread.h>
 #include <semaphore.h>
@@ -371,3 +375,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-solaris.cc	2014-06-22 19:23:18.000000000 +0800
+++ src/platform-solaris.cc	2014-06-22 19:58:53.000000000 +0800
@@ -5,6 +5,10 @@
 // Platform-specific code for Solaris 10 goes here. For the POSIX-compatible
 // parts, the implementation is in platform-posix.cc.
 
+#include <osconfig.h>
+
+#ifdef Solaris
+
 #ifdef __sparc
 # error "V8 does not support the SPARC CPU architecture."
 #endif
@@ -277,3 +281,5 @@
 }
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform-win32.cc	2014-06-14 01:44:18.000000000 +0800
+++ src/platform-win32.cc	2014-06-22 19:58:53.000000000 +0800
@@ -4,6 +4,10 @@
 
 // Platform-specific code for Win32.
 
+#include <osconfig.h>
+
+#ifdef Windows
+
 // Secure API functions are not available using MinGW with msvcrt.dll
 // on Windows XP. Make sure MINGW_HAS_SECURE_API is not defined to
 // disable definition of secure API functions in standard headers that
@@ -799,9 +803,11 @@
 }
 
 
+#if 0
 void OS::Sleep(int milliseconds) {
   ::Sleep(milliseconds);
 }
+#endif
 
 
 void OS::Abort() {
@@ -1304,7 +1310,7 @@
   return false;
 }
 
-
+#if 0
 // ----------------------------------------------------------------------------
 // Win32 thread support.
 
@@ -1406,5 +1412,8 @@
 void Thread::YieldCPU() {
   Sleep(0);
 }
+#endif
 
 } }  // namespace v8::internal
+
+#endif
--- /Users/lion/Downloads/source/js/v8/src/platform.h	2014-06-14 01:44:18.000000000 +0800
+++ src/platform.h	2014-06-22 19:58:53.000000000 +0800
@@ -77,6 +77,8 @@
 // ----------------------------------------------------------------------------
 // Fast TLS support
 
+#define V8_NO_FAST_TLS
+
 #ifndef V8_NO_FAST_TLS
 
 #if defined(_MSC_VER) && (V8_HOST_ARCH_IA32)
