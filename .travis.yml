dist: trusty
language: cpp
services:
  - docker
matrix:
  include:
    - os: osx
      osx_image: xcode9
      env:
        - ARCH=amd64
    - os: osx
      osx_image: xcode9
      env:
        - ARCH=i386
    - os: linux
      env:
        - ARCH=amd64
    - os: linux
      env:
        - ARCH=i386
    - os: linux
      env:
        - ARCH=arm
    - os: linux
      env:
        - ARCH=arm64
    - os: linux
      env:
        - ARCH=mips
    - os: linux
      env:
        - ARCH=mips64
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      rvm install ruby-2.4.0;
      rvm --default use 2.4.0;
      ruby -v;
      brew update;
    fi
install:
  - git submodule init
  - git submodule update
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      docker pull zhixiangxiao/build-env:xenial;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew install xz;
    fi
script:
  - echo "${ARCH}"
  - ./.travis/build.sh
  - ./.travis/test.sh
  - if [[ "$TRAVIS_TAG" != "" ]]; then 
      ./.travis/release.sh; 
    fi
deploy:
  - provider: releases
    api_key:
      secure: kbD30d/9E4pIhPwjw5xaPnISirkhkoz+a1kHA+0/a4DpVjjbEFFEY8Qqu6H0EGEB6Io2Uw2DMft1Mr7dry7U4NF3fht7LxH5XCoB5MKimNXNrbiyXVlZ9eDMJNKUFWMEwHvJre037Sh4vUmkJgZXitQZ42nJbNqe+tHpjWCLeMfvQHORMvyeG8ar95rrju6lqepELFlS33VJaZXprigbbKcVAStTvTj2XXk1iMVYL9ika+RfhRbWdUMCVMRdcTUFE+NW/WnngHf9NnVe20FsEoeKm41nqofuYBDqPffKNpSSkXwrmoDrDW5M9yhgE6aLogugSIbY787604cke3KwF77Q9fRbYvnLcm6FBe9yuUG6mGhx693CP5lXXgKcbGGS9dhiXuExyjLhYB/FQH9Gso2XN4fLni190xKJwbA11GoN11FSDSewkfsIioQJJJqfz1SNr7HT8saURB2l29fe0nDCjWZavzpRvS6MXzO6g805rESGgDxBvesbPC/orExqL7atwQ3W31Mb7nB+55Y1HS4tI/d36uQMN1B0q+zJa+io4Yn8YvDI5QZFNNaKYhpCLKNZuR0pUiO6yXM5FmwaA62FjWof2FLtZ44IdgDH3KCu+7n9hEf3NDfmDSLC3jzK2dMEwAlwSkRuNGBE6arso4bOJJxDCYV1krbnvddnusc=
    file_glob: true
    file: ${TRAVIS_TAG}/*
    skip_cleanup: true
    overwrite: true
    on:
      tags: true
      repo: jayshanx/fibjs
